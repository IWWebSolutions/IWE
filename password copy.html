<!doctype html>
<html class="no-js" lang="zxx">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.8/lottie.min.js"></script>
    <div id="head"></div>
</head>
<body>
    <!-- Header content will be loaded dynamically -->
    <div id="header"></div>

    <!-- Breadcrumb Area -->
    <div class="breadcrumb-area">
        <div class="container">
            <div class="breadcrumb-content">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li class="active">Forgot Password</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Forgot Password Content Area -->
    <div class="page-section mb-60">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 col-md-12 col-xs-12 col-lg-6 mb-30">
                    <!-- Forgot Password Form -->
                    <form id="forgotPasswordForm">
                        <div class="login-form">
                            <h4 class="login-title">Let us help you reset your password!</h4>
                            <div class="row">
                                <!-- Email Input -->
                                <div class="col-md-12 col-12 mb-20">
                                    <label>Enter your registered email address<span class="red">*</span></label>
                                    <div style="display: flex; flex-direction: column; align-items: center;">
                                        <input class="mb-0" id="email" name="email" type="email" placeholder="Email Address" style="width: 100%; max-width: 400px;">
                                        <button type="button" id="checkEmailButton" class="register-button" style="margin-top: 10px;">Submit</button>
                                    </div>
                                    <span class="error" id="emailError" style="display: block; text-align: center;"></span>
                                    <span id="emailTick" style="display: none; color: green; text-align: center;">âœ”</span>
                                </div>

                                <!-- Send OTP Button -->
                                <div class="col-md-12" id="sendOtpSection" style="display: none;">
                                    <button type="button" id="sendOtpButton" class="register-button mt-0">Send OTP / Verification Code</button>
                                    <span id="otpTimer" style="display: none; color: gray;">Resend OTP in <span id="countdown">60</span> seconds</span>
                                </div>

                                <!-- Register Button (Initially Hidden) -->
                                <div class="col-md-12" id="registerButtonSection" style="display: none;">
                                    <button type="button" id="registerButton" class="register-button mt-2" onclick="window.location.href='register.html'">Register</button>
                                </div>

                                <!-- OTP Input -->
                                <div class="col-md-12 col-12 mb-20" id="otpSection" style="display: none;">
                                    <label>Enter verification code<span class="red">*</span></label>
                                    <input class="mb-0" id="otp" name="otp" type="number" placeholder="Enter OTP">
                                    <span class="error" id="otpError"></span>
                                </div>
                                <!-- New Password Input -->
                                <div class="col-md-12 col-12 mb-20" id="newPasswordSection" style="display: none;">
                                    <label>Enter new password<span class="red">*</span></label>
                                    <input class="mb-0" id="newPassword" name="newPassword" type="password" placeholder="New Password">
                                    <span class="error" id="newPasswordError"></span>
                                </div>
                                <!-- Confirm New Password Input -->
                                <div class="col-md-12 col-12 mb-20" id="confirmPasswordSection" style="display: none;">
                                    <label>Confirm new password<span class="red">*</span></label>
                                    <input class="mb-0" id="confirmPassword" name="confirmPassword" type="password" placeholder="Confirm New Password">
                                    <span class="error" id="confirmPasswordError"></span>
                                </div>
                                <!-- Save and Login Buttons -->
                                <div class="col-md-12" id="saveSection" style="display: none;">
                                    <button type="button" id="saveButton" class="register-button mt-0">Save New Password</button>
                                    <button type="button" id="loginButton" class="register-button mt-0" onclick="window.location.href='login.html'">Login</button>
                                </div>
                                <!-- Form Response Message -->
                                <div id="formResponse" style="display: none;"></div>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- Right Side: Animation -->
                <div class="col-sm-12 col-md-12 col-xs-12 col-lg-6 mb-30">
                    <div id="animationContainer" style="width: 100%; height: 500px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer content will be loaded dynamically -->
    <div id="footer"></div>

    <!-- Scripts -->
    <!-- jQuery-V1.12.4 -->
    <script src="js/vendor/jquery-1.12.4.min.js"></script>
    <!-- Popper js -->
    <script src="js/vendor/popper.min.js"></script>
    <!-- Bootstrap V4.1.3 Fremwork js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- Ajax Mail js -->
    <script src="js/ajax-mail.js"></script>
    <!-- Meanmenu js -->
    <script src="js/jquery.meanmenu.min.js"></script>
    <!-- Wow.min js -->
    <script src="js/wow.min.js"></script>
    <!-- Slick Carousel js -->
    <script src="js/slick.min.js"></script>
    <!-- Owl Carousel-2 js -->
    <script src="js/owl.carousel.min.js"></script>
    <!-- Magnific popup js -->
    <script src="js/jquery.magnific-popup.min.js"></script>
    <!-- Isotope js -->
    <script src="js/isotope.pkgd.min.js"></script>
    <!-- Imagesloaded js -->
    <script src="js/imagesloaded.pkgd.min.js"></script>
    <!-- Mixitup js -->
    <script src="js/jquery.mixitup.min.js"></script>
    <!-- Countdown -->
    <script src="js/jquery.countdown.min.js"></script>
    <!-- Counterup -->
    <script src="js/jquery.counterup.min.js"></script>
    <!-- Waypoints -->
    <script src="js/waypoints.min.js"></script>
    <!-- Barrating -->
    <script src="js/jquery.barrating.min.js"></script>
    <!-- Jquery-ui -->
    <script src="js/jquery-ui.min.js"></script>
    <!-- Venobox -->
    <script src="js/venobox.min.js"></script>
    <!-- Nice Select js -->
    <script src="js/jquery.nice-select.min.js"></script>
    <!-- ScrollUp js -->
    <script src="js/scrollUp.min.js"></script>
    <!-- Main/Activator js -->
    <script src="js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.8/lottie.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Load head content
            fetch('head.html')
                .then(res => {
                    if (!res.ok) throw new Error('Head file not found');
                    return res.text();
                })
                .then(data => {
                    document.getElementById('head').innerHTML = data;
                })
                .catch(error => console.error('Error loading head:', error));

            // Load header content
            fetch('header.html')
                .then(res => {
                    if (!res.ok) throw new Error('Header file not found');
                    return res.text();
                })
                .then(data => {
                    document.getElementById('header').innerHTML = data;

                    // Attach event listeners after the header is loaded
                    attachEventListeners();
                })
                .catch(error => console.error('Error loading header:', error));

            // Load footer content
            fetch('footer.html')
                .then(res => {
                    if (!res.ok) throw new Error('Footer file not found');
                    return res.text();
                })
                .then(data => {
                    document.getElementById('footer').innerHTML = data;
                })
                .catch(error => console.error('Error loading footer:', error));
        });

        function attachEventListeners() {
            document.querySelectorAll(".redirect").forEach(link => {
                link.addEventListener("click", function(event){
                    event.preventDefault();
                    window.location.href = "maintenance.html";
                });
            });

            document.querySelectorAll(".soon").forEach(link => {
                link.addEventListener("click", function(event){
                    event.preventDefault();
                    window.location.href = "coming-soon.html";
                });
            });
        }

        const animationContainer = document.getElementById('animationContainer');
            if (animationContainer) {
                lottie.loadAnimation({
                    container: animationContainer,
                    renderer: 'svg',
                    loop: true,
                    autoplay: true,
                    path: 'https://assets10.lottiefiles.com/packages/lf20_sk5h1kfn.json' // Replace with your animation JSON URL
                });
            }

        document.addEventListener("DOMContentLoaded", function () {
            const emailInput = document.getElementById("email");
            const checkEmailButton = document.getElementById("checkEmailButton");
            const emailError = document.getElementById("emailError");
            const emailTick = document.getElementById("emailTick");
            const sendOtpSection = document.getElementById("sendOtpSection");
            const sendOtpButton = document.getElementById("sendOtpButton");
            const otpSection = document.getElementById("otpSection");
            const otpInput = document.getElementById("otp");
            const otpError = document.getElementById("otpError");
            const newPasswordSection = document.getElementById("newPasswordSection");
            const confirmPasswordSection = document.getElementById("confirmPasswordSection");
            const saveSection = document.getElementById("saveSection");
            const formResponse = document.getElementById("formResponse");
            const otpTimer = document.getElementById("otpTimer");
            const countdown = document.getElementById("countdown");

            let timer;
            let timeLeft = 60;

            // Validate Email
            checkEmailButton.addEventListener("click", function () {
                const email = emailInput.value.trim();

                if (!email || !email.includes("@")) {
                    emailError.textContent = "Please enter a valid email.";
                    emailTick.style.display = "none";
                    sendOtpSection.style.display = "none";
                    registerButtonSection.style.display = "none";
                    return;
                }

                fetch("/check-email/", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.exists) {
                        emailError.textContent = "";
                        emailTick.style.display = "inline";
                        sendOtpSection.style.display = "block";
                        registerButtonSection.style.display = "none";
                    } else {
                        emailError.textContent = "Email isn't registered. Kindly register with us.";
                        emailTick.style.display = "none";
                        sendOtpSection.style.display = "none";
                        registerButtonSection.style.display = "block";
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    emailError.textContent = "An error occurred. Please try again.";
                    registerButtonSection.style.display = "none";
                });
            });
        

            // Send OTP
            sendOtpButton.addEventListener("click", function () {
                const email = emailInput.value.trim();
                fetch("/send-otp/", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        formResponse.style.display = "block";
                        formResponse.textContent = "OTP sent to your email.";
                        otpSection.style.display = "block";
                        startTimer();
                    } else {
                        formResponse.style.display = "block";
                        formResponse.textContent = "Failed to send OTP. Please try again.";
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    formResponse.style.display = "block";
                    formResponse.textContent = "An error occurred. Please try again.";
                });
            });

            // Verify OTP
            otpInput.addEventListener("blur", function () {
                const otp = otpInput.value.trim();
                const email = emailInput.value.trim();
                if (otp.length === 6) {
                    fetch("/verify-otp/", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ email, otp }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            otpError.textContent = "";
                            newPasswordSection.style.display = "block";
                            confirmPasswordSection.style.display = "block";
                            saveSection.style.display = "block";
                        } else {
                            otpError.textContent = "Invalid OTP. Please try again.";
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        otpError.textContent = "An error occurred. Please try again.";
                    });
                }
            });

            // Save New Password
            document.getElementById("saveButton").addEventListener("click", function () {
                const newPassword = document.getElementById("newPassword").value.trim();
                const confirmPassword = document.getElementById("confirmPassword").value.trim();
                const email = emailInput.value.trim();

                if (newPassword !== confirmPassword) {
                    document.getElementById("confirmPasswordError").textContent = "Passwords do not match.";
                } else {
                    fetch("/reset-password/", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ email, newPassword }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            formResponse.style.display = "block";
                            formResponse.textContent = "Password reset successfully. Redirecting to login page...";
                            setTimeout(() => {
                                window.location.href = "/login/";
                            }, 3000);
                        } else {
                            formResponse.style.display = "block";
                            formResponse.textContent = "Failed to reset password. Please try again.";
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        formResponse.style.display = "block";
                        formResponse.textContent = "An error occurred. Please try again.";
                    });
                }
            });

            // Redirect to Login
            document.getElementById("loginButton").addEventListener("click", function () {
                window.location.href = "/login/";
            });

            // Timer for OTP Resend
            function startTimer() {
                otpTimer.style.display = "block";
                timer = setInterval(() => {
                    timeLeft--;
                    countdown.textContent = timeLeft;
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        otpTimer.style.display = "none";
                        timeLeft = 60;
                    }
                }, 1000);
            }
        });
    </script>
</body>
</html>